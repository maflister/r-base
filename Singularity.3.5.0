BootStrap: docker
From: ubuntu:16.04

%help
    This container runs R.

%labels
    Maintainer Matthew Flister

%apprun R
    exec R "${@}"

%apprun Rscript
    exec Rscript "${@}"

%runscript
    exec R "${@}"

%environment 
    export R_LIBS=/usr/local/lib/R/library:/extR/library1:/extR/library2

%post
    mkdir -p /scratch/global /scratch/local /rcc/stor1/refdata /rcc/stor1/projects /rcc/stor1/depts /extR/library1 /extR/library2
    apt-get update && apt-get -y install \
        wget \
        gfortran \
        g++ \
        gcc \
        make \
        libcurl3-gnutls \
        zlib1g-dev \
        libbz2-dev \
        liblzma-dev \
        libpcre3-dev \
        libcurl4-gnutls-dev \
        libgmp-dev 

    # install R
    export R_VERSION=3.5.0
    export R_URL=https://cran.r-project.org/src/base/R-3/R-${R_VERSION}.tar.gz
    wget $R_URL
    tar -xvf R-${R_VERSION}.tar.gz
    cd R-${R_VERSION}
    ./configure --enable-R-shlib --with-blas --with-lapack --with-readline=no --with-x=no
    make && make install

    # cleanup
    cd .. && rm -rf R-${R_VERSION}*
    rm -rf /tmp/*
    apt-get -y purge \
        wget \
        zlib1g-dev \
        libbz2-dev \
        liblzma-dev \
        libpcre3-dev \
        libcurl4-gnutls-dev
    apt-get -y autoclean
    apt-get -y autoremove
    rm -rf /var/lib/apt/lists/*

